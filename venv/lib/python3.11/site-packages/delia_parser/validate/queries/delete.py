# -*- coding:utf-8 -*-
from delia_parser import ast
from delia_commons.errors import ErrorCode


class Delete:
    def visit_DeleteRelation(self, node):

        self.visit(node.qualified_rel_alias)

        relation_definition = node.relation_name.definition
        if relation_definition and not isinstance(relation_definition, ast.Relation):
            self.add_error(ErrorCode.INVALID_DEFINITION_TYPE, node.relation_name, name=node.relation_name, kind="RELATION")

        if node.qualified_rel_alias.original_via_clause is None and not node.qualified_rel_alias.with_where_clause:
            if not node.all:
                self.add_error(ErrorCode.NESTED_ALL_KEYWORD, node.relation_name, relation_name=node.relation_name)
