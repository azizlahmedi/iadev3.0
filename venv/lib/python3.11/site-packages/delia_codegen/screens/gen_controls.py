#! /usr/bin/env python
# -*- coding:utf-8 -*-
from delia_codegen.utils import adl_name_to_py_name


class FramesControls:

    def gen_ClearFrame(self, node):

        if node.in_local_function_key:
            self.src.newline("adl_clear_frame_with_stack(")
        else:
            self.src.newline("adl_clear_frame(")

        # Need the ns to restore frame fields/arrays to default value.
        self.src.write("ns_frames=(%s,)" % ",".join([adl_name_to_py_name(frame_name) for frame_name in node.frame_names]))

        self.src.write(", frames=(")
        for frame_name in node.frame_names:
            self.src.write("_frames['%s'], " % adl_name_to_py_name(frame_name))
        self.src.write(")")

        if node.in_local_function_key:
            self.src.write(", frame_stack=frame_stack")

        self.src.write(")")

    def gen_Restore(self, node):

        if node.in_local_function_key:
            self.src.newline("adl_restore_frame_with_stack(")
        else:
            self.src.newline("adl_restore_frame(")

        self.src.write("frames=(")
        for frame_name in node.frame_names:
            self.src.write("_frames['%s'], " % adl_name_to_py_name(frame_name))
        self.src.write(")")

        if node.in_local_function_key:
            self.src.write(", frame_stack=frame_stack")

        self.src.write(")")

    def gen_SetCursor(self, node):
        self.src.newline("# [ CODEGEN ] SetCursor is deprecated")

    def gen_Wait(self, node):
        self.output_items(node.output_list, "_wait")
